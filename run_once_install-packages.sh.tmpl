{{- if eq .chezmoi.os "linux" -}}
#!/bin/bash
set -euo pipefail

echo "ðŸš€ Setting up Ubuntu environment..."

# Update package lists
sudo apt-get update

# Install basic dependencies
echo "ðŸ“¦ Installing base packages..."
sudo apt-get install -y \
    curl \
    wget \
    git \
    build-essential \
    unzip \
    tar

# Install ripgrep
if ! command -v rg &> /dev/null; then
    echo "ðŸ” Installing ripgrep..."
    sudo apt-get install -y ripgrep
fi

# Install eza (modern ls replacement)
if ! command -v eza &> /dev/null; then
    echo "ðŸ“ Installing eza..."
    sudo mkdir -p /etc/apt/keyrings
    wget -qO- https://raw.githubusercontent.com/eza-community/eza/main/deb.asc | sudo gpg --dearmor -o /etc/apt/keyrings/gierens.gpg
    echo "deb [signed-by=/etc/apt/keyrings/gierens.gpg] http://deb.gierens.de stable main" | sudo tee /etc/apt/sources.list.d/gierens.list
    sudo chmod 644 /etc/apt/keyrings/gierens.gpg /etc/apt/sources.list.d/gierens.list
    sudo apt-get update
    sudo apt-get install -y eza
fi

# Install bat (better cat)
if ! command -v bat &> /dev/null; then
    echo "ðŸ¦‡ Installing bat..."
    sudo apt-get install -y bat
    # Ubuntu installs as 'batcat', create symlink
    mkdir -p ~/.local/bin
    ln -sf /usr/bin/batcat ~/.local/bin/bat
fi

# Install lazygit
if ! command -v lazygit &> /dev/null; then
    echo "ðŸ™ Installing lazygit..."
    LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
    curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
    tar xf lazygit.tar.gz lazygit
    sudo install lazygit /usr/local/bin
    rm lazygit lazygit.tar.gz
fi

# Install Neovim (latest stable)
if ! command -v nvim &> /dev/null; then
    echo "âœï¸  Installing Neovim..."
    NVIM_VERSION=$(curl -s "https://api.github.com/repos/neovim/neovim/releases/latest" | grep -Po '"tag_name": "\K[^"]*')
    curl -Lo nvim-linux64.tar.gz "https://github.com/neovim/neovim/releases/download/${NVIM_VERSION}/nvim-linux64.tar.gz"
    sudo rm -rf /opt/nvim-linux64
    sudo tar -C /opt -xzf nvim-linux64.tar.gz
    sudo ln -sf /opt/nvim-linux64/bin/nvim /usr/local/bin/nvim
    rm nvim-linux64.tar.gz
fi

# Install Starship prompt (optional but nice)
if ! command -v starship &> /dev/null; then
    echo "ðŸš€ Installing Starship prompt..."
    curl -sS https://starship.rs/install.sh | sh -s -- -y
fi

# Ensure ~/.local/bin is in PATH
if [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
fi

echo "âœ… Setup complete! Restart your shell or run: source ~/.bashrc"
{{- end -}}
